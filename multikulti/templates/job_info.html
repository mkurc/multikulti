{% extends "index.html" %}
{% macro waiting_for_results(t) %}
<center><h2>Job is running...</h2></center>
<div class="row">
    <div id="waiting{{t}}" class="col-md-offset-3 col-md-6"></div>
</div>

{% endmacro %}

        {% block indexuniq %}
        {% endblock %}
    {% block header %}
    <title>CABSdock: {{sys['project_name']}}</title>
<style>
path {
  fill-rule: evenodd;
  stroke: #333;
  stroke-width: 2px;
}

.sun path {
  fill: #5cb85c;
}

.planet path {
  fill: #f0ad4e;
}

.annulus path {
  fill: #428bca;
}
</style>
    {% endblock %}

{% block body %}
<div class="container">

<!-- Nav tabs -->
<ul class="nav nav-tabs" role="tablist">
  <li class="active"><a href="#summary" role="tab" data-toggle="tab"><i class="fa fa-info"></i> Job status information</a></li>
  <li><a href="#models" role="tab" data-toggle="tab"><i class="fa fa-database"></i> Docking results</a></li>
  <li><a href="#clustering" role="tab" data-toggle="tab"><i class="fa fa-bar-chart"></i> Clustering info</a></li>
  <li><a href="#constraints" role="tab" data-toggle="tab"><i class="fa fa-wrench"></i> Simulation parameters</a></li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane active" id="summary">
              
            <div class="row">
                <div class="col-md-6">
            <h3>
                Project name: {{sys['project_name']}}
            </h3>

        </div>
        <div class="col-md-6">
            <h4>Status:                    {{status|safe}}</h4>
            <h6>submitted: {{sys['status_date']}}, status changed: {{sys['status_change']}}</h6>
            </div>

        </div>

            <hr>

            <div class="progress">
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                    0%
                </div>
            </div>


            <p> Jakie≈õ lorem ispsumsd alfjsd oac </p>

  </div> <!-- end tab summary -->
  <div class="tab-pane" id="models">
                {% if status_type=='running' %}
                    {{waiting_for_results(a)}}
              {% endif %}
  </div> <!-- end tab models -->
  <div class="tab-pane" id="clustering">
                {% if status_type=='running' %}
                    {{waiting_for_results(a)}}
              {% endif %}
  </div> <!-- end tab clustering -->
  <div class="tab-pane" id="constraints">
      <table class="table table-hover">
        <tr>
            <td><strong>
Receptor sequence(s)
                </strong>
            </td>
            <td>
                <span class='sequence'>{{sys['receptor_sequence']}}</span>
            </td>
        </tr>


        <tr>
            <td><strong>
Ligand sequence
                </strong>
            </td>
            <td>
                <span class='sequence'>{{sys['ligand_sequence']}}</span>
            </td>
        </tr>
        <tr>
            <td><strong>
                    Ligand secondary structure 
                </strong>
                    {% if sys['ss_psipred']==1 %}
                        <span class="label label-info pull-right">pred. by PSIPRED</span>
                    {% endif %} 
            </td>
            <td>
                    {% if sys['ligand_ss']|length != sys['ligand_sequence']|length %}
                    <small><i>waiting for PSIPRED prediction</i></small>
                    {% else %}
                <span class='sequence'>{{sys['ligand_ss']}}</span>
                    {% endif %}
            </td>
        </tr>
      <tr><td>
      <h5>Restraints <small>restrained chain fragments and force scaling factor</h5>
      </td>
      <td>
          
      <table class="table table-bordered table-stripped table-condensed">
          {% set break=5 %}
          {% set iter=0 %}
        <tr>
          {% for row in constr %}
          <td><small>{{row['constraint_definition']}}</small> <span class="badge">{{row['force']}}</span></td>
            {% set iter = iter + 1 %}
            {% if iter==break %}
                </tr><tr>
            {% set iter=0 %}
            {%endif%}

            
          {% endfor %}
      </table>
  </td>
  </tr>
  <tr><td><h5>Restraints global scaling factor</h5></td><td> {{sys['constraints_scaling_factor']}}</td></tr>

      </table>
  </div> <!-- end tab costam -->
</div>
<br>&nbsp;
<div class="alert alert-warning alert-dismissible" role="alert">
  <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
  <i class="fa fa-recycle"></i> <strong>Note</strong> If task is done, page will be deleted after {{config['DELETE_USER_JOBS_AFTER']}} days.
</div>

</div>
{% endblock %}
{% block below_js %}
<script>

var finishUTC = 60000*1; // za 10 minut

var initUTC = 1414257998*1000; // wziac z bazy
              initUTC =new Date().getTime(); // wypirdolic

function tick() {
    var bar = $('.progress-bar');
    setTimeout(function () {
        var d = new Date().getTime();
        var progress = Math.max(Math.min(Math.ceil(100.0*(d - initUTC)/finishUTC), 100));
        var percnt = progress+"%";
        bar.attr('aria-valuenow', progress).css('width', percnt).html(percnt);

        if (progress==100) {
            return;
        }

        tick();
 }, 5000);
}
tick();
</script>
{% if status_type=='running' %}
    {% include "waiting_applet.html" %}
{% endif %}

{% endblock %}
